<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4. Instruction Schema</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        table { width: 100%; border-collapse: collapse; margin-top: 1.5rem; margin-bottom: 1.5rem; }
        th, td { border: 1px solid #e2e8f0; padding: 0.75rem 1rem; text-align: left; vertical-align: top; }
        th { background-color: #f8fafc; font-weight: 600; }
        pre { background-color: #f1f5f9; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; margin-top: 1rem; margin-bottom: 1rem; }
        code { font-family: 'Courier New', Courier, monospace; }
        .prose h1 { font-size: 2.25rem; font-weight: 700; margin-bottom: 1.5rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; }
        .prose h2 { font-size: 1.875rem; font-weight: 600; margin-top: 2.5rem; margin-bottom: 1rem; border-bottom: 1px solid #e2e8f0; padding-bottom: 0.5rem; }
        .prose h3 { font-size: 1.5rem; font-weight: 600; margin-top: 2rem; margin-bottom: 1rem; }
        .prose p, .prose ul { margin-bottom: 1.25rem; line-height: 1.75; }
        .prose ul { list-style-type: disc; padding-left: 1.5rem; }
        .prose a { color: #2563eb; text-decoration: none; font-weight: 500; }
        .prose a:hover { text-decoration: underline; }
        .prose code { background-color: #f1f5f9; padding: 0.2rem 0.4rem; border-radius: 0.25rem; font-size: 0.9em; }

        /* Styles for Demos */
        .rendered-example { 
            background-color: #f8fafc; 
            padding: 1.5rem; 
            border-radius: 0.5rem; 
            margin-top: 1rem; 
            margin-bottom: 2rem; 
            border: 1px solid #e2e8f0; 
        }
        .demo-container {
            border: 1px dashed #9ca3af;
            border-radius: 0.5rem;
            padding: 1rem;
            background: #fff;
        }
        .demo-Module-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #4b5563;
            padding: 0.25rem 0.75rem;
            background-color: #e2e8f0;
            border-radius: 0.375rem;
            display: inline-block;
            margin-bottom: 1rem;
        }
        .slider-wrapper { position: relative; padding-bottom: 2rem; }
        .slider-labels { position: relative; width: 100%; height: 20px; }
        .slider-label-item { position: absolute; transform: translateX(-50%); font-size: 0.875rem; color: #4b5563; white-space: nowrap; top: 8px; }
        .slider-label-item.min { transform: translateX(0); left: 0; }
        .slider-label-item.max { transform: translateX(-100%); right: 0; }
        
        /* Feedback styles */
        .feedback-correct { color: #16a34a; }
        .feedback-incorrect { color: #dc2626; }
        .feedback-practice {
            background-color: #f0fdf4;
            color: #15803d;
            border: 1px solid #bbf7d0;
        }
        .sidebar { width: 250px; position: fixed; left: 0; top: 0; height: 100vh; overflow-y: auto; background-color: #1f2937; }
        .content-wrapper { margin-left: 250px; }
        .nav-link { display: block; padding: 0.75rem 1.5rem; color: #d1d5db; text-decoration: none; border-left: 3px solid transparent; }
        .nav-link:hover { background-color: #374151; color: white; }
        .nav-link.active { background-color: #374151; color: white; border-left-color: #3b82f6; font-weight: 600; }
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; position: relative; }
            .content-wrapper { margin-left: 0; }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">

    <nav class="sidebar">
        <div class="py-4">
            <a href="overview.html" class="nav-link">1. Overview</a>
            <a href="config_schema.html" class="nav-link">2. Config Schema (config.json)</a>
            <a href="trial_schema.html" class="nav-link">3. Trial Schema (stimuli.jsonl)</a>
            <a href="instruction_schema.html" class="nav-link active">4. Instruction Schema</a>
            <a href="human_data_schema.html" class="nav-link">5. Human Data Schema</a>
        </div>
    </nav>

    <div class="content-wrapper">
    <div class="container mx-auto max-w-4xl p-6 md:p-12 bg-white shadow-lg rounded-lg my-12 prose prose-lg">

        <h1>4. File Specification: Instruction Schema (<code>instruction.jsonl</code>)</h1>
        <p>The <code>instruction.jsonl</code> file defines the sequence of screens (instructions, test trials, quizzes) that a participant sees before the main experiment begins. Each line contains one JSON object representing a "Module" object, which are presented in order.</p>

        <section>
            <h2>4.1. Top-Level Structure</h2>
            <p>The file contains one "Module" object per line. Each Module object must have a <code>type</code> field, which determines the other required fields.</p>
            <pre><code>{ "type": "instruction", ... }
{ "type": "test_trial", ... }
{ "type": "comprehension_quiz", ... }</code></pre>
        </section>

        <section>
            <h2>4.2. Module Type: <code>instruction</code></h2>
            <p>This is the most common Module. It displays a page of text and/or images to the participant.</p>
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>type</code></td>
                        <td>String</td>
                        <td>Must be <code>"instruction"</code>.</td>
                    </tr>
                    <tr>
                        <td><code>text</code></td>
                        <td>String</td>
                        <td>The main body of text for the page. Can contain simple HTML tags like <code>&lt;p&gt;</code>, <code>&lt;strong&gt;</code>, <code>&lt;ul&gt;</code>, <code>&lt;li&gt;</code>.</td>
                    </tr>
                    <tr>
                        <td><code>media_url</code></td>
                        <td>Array of Strings</td>
                        <td>(Optional) An array of image/video paths to display, identical to the <code>media_url</code> in <code>stimuli.jsonl</code>.</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>4.3. Module Type: <code>test_trial</code></h2>
            <p>This Module displays a fully functional trial (a stimulus and queries) from <code>stimuli.jsonl</code>. This allows participants to practice the task.</p>
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>type</code></td>
                        <td>String</td>
                        <td>Must be <code>"test_trial"</code>.</td>
                    </tr>
                    <tr>
                        <td><code>stimuli_id</code></td>
                        <td>String</td>
                        <td>The <code>stimuli_id</code> of the trial from <code>stimuli.jsonl</code> to display.</td>
                    </tr>
                    <tr>
                        <td><code>feedback</code></td>
                        <td>String</td>
                        <td>(Optional) A text block to show after the user clicks "Submit", e.g., "The correct answer for this practice trial is X."</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <h2>4.4. Module Type: <code>comprehension_quiz</code></h2>
            <p>This Module presents one or more questions (identical to the <a href="trial_schema.html#queries">Query Object</a> format) to check the participant's understanding. It provides immediate feedback.</p>
            <table>
                <thead>
                    <tr>
                        <th>Key</th>
                        <th>Type</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>type</code></td>
                        <td>String</td>
                        <td>Must be <code>"comprehension_quiz"</code>.</td>
                    </tr>
                    <tr>
                        <td><code>text</code></td>
                        <td>String</td>
                        <td>(Optional) Introductory text to display above the questions.</td>
                    </tr>
                    <tr>
                        <td><code>queries</code></td>
                        <td>Array of Objects</td>
                        <td>An array of <a href="trial_schema.html#queries">Query Objects</a> (as defined in <a href="trial_schema.html#queries">Section 3.2</a>). These are the quiz questions. See note below.</td>
                    </tr>
                </tbody>
            </table>
            <p><strong>Note on Quiz Queries:</strong> Queries within a <code>comprehension_quiz</code> (usually <code>multi-choice</code>) <strong>must</strong> include an <code>answer</code> field to provide real-time feedback to the user. The <code>answer</code> field is defined in the <a href="trial_schema.html#queries">Trial Schema (Section 3.2)</a>.</p>
        </section>

        <section>
            <h2>4.5. Full <code>instruction.jsonl</code> Example</h2>
            <p>This example shows a sequence containing a welcome page, a second instruction page with an image, a test trial, and a final comprehension quiz.</p>
            <pre><code>{
  "type": "instruction",
  "text": "<p>Thank you for participating. In this task, you will observe an agent (a blue circle) move in a simple environment.</p><strong>Your goal is to determine what the agent wants.</strong><p>Please pay close attention to its behavior.</p>"
}
{
  "type": "instruction",
  "text": "<p>You will see a scene like the one below. The blue circle is the agent. The red and blue boxes are potential goals. Your task is to judge which goal the agent wants after observing its movement.</p>",
  "media_url": [
    "https://placehold.co/600x400/e2e8f0/334155?text=Example+Scene"
  ]
}
{
  "type": "test_trial",
  "stimuli_id": "trial_agent_01",
  "feedback": "In this example, the player is going for the red box!"
}
{
  "type": "comprehension_quiz",
  "text": "<p>Please answer the following questions.</p>",
  "queries": [
    {
      "prompt": "What is your main task in this experiment?",
      "type": "multi-choice",
      "tag": "quiz_q1",
      "option": [
        "To click the boxes as fast as possible.",
        "To determine the agent's goal.",
        "To count the number of circles."
      ],
      "answer": 1
    },
    {
      "prompt": "Is this a timed experiment?",
      "type": "multi-choice",
      "tag": "quiz_q2",
      "option": [
        "Yes",
        "No"
      ],
      "answer": 1
    }
  ]
}</code></pre>
        </section>
        
        <section>
            <h2>4.6. Live Demo of Instruction Sequence</h2>
            <p>Below is a simulation of how the sequence from the example JSON above would be rendered to the participant, one Module at a time. <strong>Click the options in Module 4 to see the feedback.</strong></p>

            <div class="demo-container space-y-4">
                
                <div class="rendered-example">
                    <span class="demo-Module-label">Module 1 of 4: Instruction</span>
                    <div class="space-y-4 text-base text-gray-700">
                        <p>Thank you for participating. In this task, you will observe an agent (a blue circle) move in a simple environment.</p><strong>Your goal is to determine what the agent wants.</strong><p>Please pay close attention to its behavior.</p>
                    </div>
                </div>

                <div class="rendered-example">
                    <span class="demo-Module-label">Module 2 of 4: Instruction</span>
                    <div class="space-y-4 text-base text-gray-700">
                        <p>You will see a scene like the one below. The blue circle is the agent. The red and blue boxes are potential goals. Your task is to judge which goal the agent wants after observing its movement.</p>
                        <img src="https://placehold.co/600x400/e2e8f0/334155?text=Example+Scene" alt="Example Scene" class="w-full max-w-lg mx-auto rounded-md shadow-sm my-4">
                    </div>
                </div>

                <div class="rendered-example">
                    <span class="demo-Module-label">Module 3 of 4: Practice Trial</span>
                    
                    <div class="rendered-example bg-gray-100 p-4 rounded-md mb-8 border border-gray-200 not-prose">
                        <img src="https://placehold.co/600x400/e2e8f0/334155?text=Example+Stimulus+Image" alt="Example Stimulus" class="w-full max-w-lg mx-auto rounded-md shadow-sm mb-4">
                        <p class="text-base text-gray-700 italic text-center mb-6">Observe the agent's action in the image above.</p>
                        
                        <div class="bg-white p-4 rounded-md shadow-inner">
                            <div class="mb-6">
                                <p class="font-medium mb-3 text-gray-900">What is the agent's primary goal?</p>
                                <div class="space-y-2">
                                    <label class="flex items-center"><input type="radio" name="agent-goal-demo" class="form-radio text-blue-600 h-5 w-5"><span class="ml-2 text-gray-700">Reaching the red box</span></label>
                                    <label class="flex items-center"><input type="radio" name="agent-goal-demo" class="form-radio text-blue-600 h-5 w-5"><span class="ml-2 text-gray-700">Reaching the blue box</span></label>
                                    <label class="flex items-center"><input type="radio" name="agent-goal-demo" class="form-radio text-blue-600 h-5 w-5"><span class="ml-2 text-gray-700">Looking for a key</span></label>
                                </div>
                            </div>
                            <div>
                                <p class="font-medium mb-3 text-gray-900">How confident are you in your answer?: <span class="font-semibold">50</span></p>
                                <div class="slider-wrapper">
                                    <input type="range" min="0" max="100" value="50" class="w-full" oninput="this.previousElementSibling.innerText = this.value">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="feedback-practice p-4 rounded-md text-sm mt-4">
                        <strong>Feedback:</strong> In this example, the player is going for the red box!
                    </div>
                </div>

                <div class="rendered-example">
                    <span class="demo-Module-label">Module 4 of 4: Comprehension Check</span>
                    <div class="space-y-4 text-base text-gray-700">
                        <p>Please answer the following questions.</p>
                    </div>

                    <div class="space-y-6 mt-6">
                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p class="font-medium mb-3">What is your main task in this experiment?</p>
                            <div class="space-y-2" role="radiogroup" aria-labelledby="quiz_q1-label">
                                <label class="flex items-center p-3 rounded-md hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="quiz_q1" value="0" onchange="checkAnswer('quiz_q1-feedback', this.value, 1)" class="form-radio text-blue-600 h-5 w-5">
                                    <span class="ml-3 text-gray-700">To click the boxes as fast as possible.</span>
                                </label>
                                <label class="flex items-center p-3 rounded-md hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="quiz_q1" value="1" onchange="checkAnswer('quiz_q1-feedback', this.value, 1)" class="form-radio text-blue-600 h-5 w-5">
                                    <span class="ml-3 text-gray-700">To determine the agent's goal.</span>
                                </label>
                                <label class="flex items-center p-3 rounded-md hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="quiz_q1" value="2" onchange="checkAnswer('quiz_q1-feedback', this.value, 1)" class="form-radio text-blue-600 h-5 w-5">
                                    <span class="ml-3 text-gray-700">To count the number of circles.</span>
                                </label>
                            </div>
                            <div id="quiz_q1-feedback" class="mt-3 text-sm font-medium"></div>
                        </div>

                        <div class="bg-white p-4 rounded border border-gray-200">
                            <p class="font-medium mb-3">Is this a timed experiment?</p>
                            <div class="space-y-2" role="radiogroup" aria-labelledby="quiz_q2-label">
                                <label class="flex items-center p-3 rounded-md hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="quiz_q2" value="0" onchange="checkAnswer('quiz_q2-feedback', this.value, 1)" class="form-radio text-blue-600 h-5 w-5">
                                    <span class="ml-3 text-gray-700">Yes</span>
                                </label>
                                <label class="flex items-center p-3 rounded-md hover:bg-gray-50 cursor-pointer">
                                    <input type="radio" name="quiz_q2" value="1" onchange="checkAnswer('quiz_q2-feedback', this.value, 1)" class="form-radio text-blue-600 h-5 w-5">
                                    <span class="ml-3 text-gray-700">No</span>
                                </label>
                            </div>
                            <div id="quiz_q2-feedback" class="mt-3 text-sm font-medium"></div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </div>

    <script>
        function checkAnswer(feedbackId, selectedValue, correctAnswerIndex) {
          const feedbackEl = document.getElementById(feedbackId);
          if (parseInt(selectedValue, 10) === correctAnswerIndex) {
            feedbackEl.textContent = "Correct!";
            feedbackEl.className = "mt-3 text-sm font-medium feedback-correct";
          } else {
            feedbackEl.textContent = "Incorrect. Please review the instructions and try again.";
            feedbackEl.className = "mt-3 text-sm font-medium feedback-incorrect";
          }
        }

        function showFeedback(feedbackId, feedbackText) {
            const feedbackEl = document.getElementById(feedbackId);
            feedbackEl.textContent = feedbackText;
            feedbackEl.classList.remove('hidden');
        }
    </script>

    </div>
    </div>
</body>
</html>